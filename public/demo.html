<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>GeoIP API Demo</title>
        <style>
            body {
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                max-width: 1200px;
                margin: 0 auto;
                padding: 20px;
                background-color: #f5f5f5;
            }
            .container {
                background: white;
                padding: 30px;
                border-radius: 10px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }
            h1 {
                color: #333;
                text-align: center;
                margin-bottom: 30px;
            }
            .form-group {
                margin-bottom: 20px;
            }
            label {
                display: block;
                margin-bottom: 5px;
                font-weight: bold;
                color: #555;
            }
            input,
            select {
                width: 100%;
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: 5px;
                font-size: 16px;
            }
            button {
                background-color: #007bff;
                color: white;
                padding: 12px 30px;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 16px;
                margin-right: 10px;
                margin-bottom: 10px;
            }
            button:hover {
                background-color: #0056b3;
            }
            .result {
                margin-top: 30px;
                padding: 20px;
                background-color: #f8f9fa;
                border-radius: 5px;
                border-left: 4px solid #007bff;
            }
            .error {
                background-color: #f8d7da;
                border-left: 4px solid #dc3545;
                color: #721c24;
            }
            pre {
                background-color: #e9ecef;
                padding: 15px;
                border-radius: 5px;
                overflow-x: auto;
                white-space: pre-wrap;
            }
            .buttons {
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
            }
            .endpoint-info {
                background-color: #e7f3ff;
                padding: 15px;
                border-radius: 5px;
                margin-bottom: 20px;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>üåê GeoIP API Demo</h1>

            <div class="endpoint-info">
                <h3>C√°c Endpoint c√≥ s·∫µn:</h3>
                <ul>
                    <li>
                        <strong>GET /geoip</strong> - Tra c·ª©u IP b·∫•t k·ª≥
                        (IPv4/IPv6)
                    </li>
                    <li><strong>GET /geoip/ipv4</strong> - Ch·ªâ IPv4</li>
                    <li><strong>GET /geoip/ipv6</strong> - Ch·ªâ IPv6</li>
                </ul>
            </div>

            <div class="form-group">
                <label for="ip"
                    >ƒê·ªãa ch·ªâ IP (ƒë·ªÉ tr·ªëng ƒë·ªÉ d√πng IP c·ªßa b·∫°n):</label
                >
                <input
                    type="text"
                    id="ip"
                    placeholder="V√≠ d·ª•: 8.8.8.8 ho·∫∑c 2001:4860:4860::8888"
                />
            </div>

            <div class="form-group">
                <label for="format">ƒê·ªãnh d·∫°ng output:</label>
                <select id="format">
                    <option value="json">JSON</option>
                    <option value="xml">XML</option>
                    <option value="csv">CSV</option>
                    <option value="yaml">YAML</option>
                </select>
            </div>

            <div class="form-group">
                <label for="callback">JSONP Callback (ch·ªâ cho JSON):</label>
                <input
                    type="text"
                    id="callback"
                    placeholder="V√≠ d·ª•: myCallback"
                />
            </div>

            <div class="buttons">
                <button onclick="testAPI('/geoip')">Test /geoip</button>
                <button onclick="testAPI('/geoip/ipv4')">
                    Test /geoip/ipv4
                </button>
                <button onclick="testAPI('/geoip/ipv6')">
                    Test /geoip/ipv6
                </button>
                <button onclick="getCurrentIP()">L·∫•y IP hi·ªán t·∫°i</button>
            </div>

            <div id="result"></div>
        </div>

        <script>
            const API_BASE = "http://localhost:8000";

            function buildURL(endpoint) {
                const ip = document.getElementById("ip").value;
                const format = document.getElementById("format").value;
                const callback = document.getElementById("callback").value;

                let url = `${API_BASE}${endpoint}?`;

                if (ip) url += `ip=${encodeURIComponent(ip)}&`;
                if (format) url += `format=${format}&`;
                if (callback && format === "json")
                    url += `callback=${callback}&`;

                return url.slice(0, -1); // Remove trailing &
            }

            function showResult(data, isError = false) {
                const resultDiv = document.getElementById("result");
                resultDiv.className = isError ? "result error" : "result";
                resultDiv.innerHTML = `<pre>${data}</pre>`;
            }

            function testAPI(endpoint) {
                const url = buildURL(endpoint);

                showResult(`üîÑ ƒêang g·ªçi: ${url}\n\nƒêang ch·ªù k·∫øt qu·∫£...`);

                fetch(url)
                    .then((response) => response.text())
                    .then((data) => {
                        showResult(`‚úÖ URL: ${url}\n\nüì° Response:\n${data}`);
                    })
                    .catch((error) => {
                        showResult(
                            `‚ùå L·ªói khi g·ªçi API: ${error.message}`,
                            true
                        );
                    });
            }

            function getCurrentIP() {
                showResult("üîÑ ƒêang l·∫•y IP hi·ªán t·∫°i...");

                fetch(`${API_BASE}/geoip`)
                    .then((response) => response.json())
                    .then((data) => {
                        document.getElementById("ip").value = data.ip;
                        showResult(
                            `‚úÖ IP hi·ªán t·∫°i c·ªßa b·∫°n: ${data.ip}\n\nƒê√£ ƒëi·ªÅn v√†o form!`
                        );
                    })
                    .catch((error) => {
                        showResult(`‚ùå L·ªói khi l·∫•y IP: ${error.message}`, true);
                    });
            }

            // Test v·ªõi IP m·∫´u khi trang load
            window.onload = function () {
                document.getElementById("ip").value = "8.8.8.8";
                testAPI("/geoip");
            };
        </script>
    </body>
</html>
